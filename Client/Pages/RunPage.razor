@page "/run"

<div>
    <p>
        v0.0.2
    </p>
    <div class="jumbotron">
        Hinweise: Um einen Lauf zu starten musst Du nicht online sein. Du kannst den gesamten Lauf ohne
        Internet-Verbindung aufzeichnen.
        Sobald Du den Lauf beendet hast (und wieder Online bist) wird der Zeitpunkt und die Distanz übertragen – die
        Strecke und Positionsdaten werden nicht an den Server gesendet.
    </div>
    <div class="btn-group">
        @if (!Run.RunInfo.isDone) {
            <button class="btn btn-primary" @onclick="@( async => StartRun())">Start run</button>
        } else {
    <div class="ml-3">
        @if (UploadStatus == Models.UploadStatus.Uploading)
        {
            <span class="oi spinner-grow spinner-grow-sm text-success"> </span> @("Uploading")
        }
        else if (UploadStatus == Models.UploadStatus.UploadSuccess)
        {
            <span class="oi oi-circle-check text-success">&nbsp;</span> @("Upload successful")
        }
        else if (UploadStatus == Models.UploadStatus.UploadFailed)
        {
            <span class="oi oi-circle-x text-danger">&nbsp;</span> @("Upload failed. Please try again later.")
        }
        else
        {

        }
    </div>

        }
    </div>
    @if (watchId > 0) {
        <div></div>
        <h4><span class="badge badge-success">Die Aufzeichung läuft. Guten Lauf!</span></h4>
        <div class="btn-group">
            <button class="btn btn-primary" @onclick="@( async => StopRun())">Stop run</button>
        </div>
    }

    <div class="mt-5 mb-5">
        <h4 class="text-white-50">Startzeit: @Run.RunInfo.StartTime.ToLocalTime()</h4>
        <h4 class="text-white-50">Du hast @Run.RunInfo.Distance m in @Run.RunInfo.Duration.ToString(@"hh\:mm\:ss")
            zurückgelegt!</h4>
        <h4><span class="badge badge-info">&empty;-Geschwindigkeit: @Run.RunInfo.KphAvg km/h</span></h4>
        <h4><span class="badge badge-info">Höchstgeschwindigkeit: @Run.RunInfo.KphMax km/h</span></h4>
        <h4><span class="badge badge-info">Gemessene Punkte: @Run.RunItems.Count</span></h4>
    </div>
    @if (watchId > 0)
    {
        <div class="btn-block">
            <button class="btn btn-primary" @onclick="RunInfo">Run Info</button>
            

        </div>
    }

    @if (Run.RunInfo.isDone)
    {
        if (Run.RunInfo.Feedback != null) {
            <FeedbackComponent Feedback="Run.RunInfo.Feedback"></FeedbackComponent>

        } else {
            <p>
                Deine Strecke wurde noch nicht übertragen. Bitte versuche es später noch einmal.
            </p>
            <button type="button" class="btn btn-warning" @onclick="@( async => SubmitData())">Strecke speichern</button>
        }
        <div>
            <RunMapComponent Run="Run"></RunMapComponent>
        </div>
    }

    <div>
        <p>
            @debugInfo
        </p>
    </div>
</div>